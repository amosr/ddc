
:set lang Flow

-- Two folds over the same input series.
:flow-prep..
module Test with letrec
test    [p : Proc] [k : Rate]
        (u1 u2 : Ref# Int#)
        (elems : Series# p k k Int#)
        : Process# p k
 =      pjoin#  [p] [k]
                (sreduce#  [p] [k] [k] [Int#] u1 (add# [Int#]) 0i# elems)
                (sreduce#  [p] [k] [k] [Int#] u2 (mul# [Int#]) 1i# elems)
;;

